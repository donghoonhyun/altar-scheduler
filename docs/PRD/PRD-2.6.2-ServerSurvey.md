# PRD-2.6.2 ServerSurvey (ë³µì‚¬ìš© ì„¤ë¬¸ í™”ë©´)

## ðŸ§© 1. ì„¹ì…˜ ê°œìš”

- `ServerSurvey`ëŠ” ë³µì‚¬ê°€ í”Œëž˜ë„ˆê°€ ê³µìœ í•œ ì„¤ë¬¸ URL(ì˜ˆ: `/survey/SG00001/202510`)ë¡œ ì ‘ì†í•˜ì—¬  
    í•´ë‹¹ ì›”ì˜ ëª¨ë“  ë¯¸ì‚¬ ì¼ì • ì¤‘ **ì°¸ì„ ë¶ˆê°€ëŠ¥í•œ ì¼ì •ë§Œ ì„ íƒ**í•˜ê³  ì œì¶œí•˜ëŠ” íŽ˜ì´ì§€ì´ë‹¤.
- ì´ í™”ë©´ì€ í”Œëž˜ë„ˆê°€ ê°œì‹œí•œ ì„¤ë¬¸(`availability_surveys/{yyyymm}`)ê³¼ ì—°ë™ë˜ë©°,  
    ë³µì‚¬ê°€ ì œì¶œí•œ ì‘ë‹µì€ Firestoreì˜ `availability_surveys/{yyyymm}/responses/{uid}` ì»¬ë ‰ì…˜ì— ì €ìž¥ëœë‹¤.

---

## ðŸ§© 2. íŽ˜ì´ì§€ ê²½ë¡œ

| ê²½ë¡œ | ì˜ˆì‹œ | ë¹„ê³  |
|------|-------|------|
| `/survey/:serverGroupId/:yyyymm` | `/survey/SG00001/202510` | ë³µì‚¬ ì„¤ë¬¸ ì „ìš© ì ‘ê·¼ ë§í¬ |

---

## ðŸ§© 3. íŽ˜ì´ì§€ êµ¬ì¡°

```tsx
    ServerSurvey
    â”œâ”€â”€ Header: ì„±ë‹¹ëª… / ì›” / ë³µì‚¬ ì´ë¦„
    â”œâ”€â”€ InfoAlert: "ì°¸ì„ ë¶ˆê°€í•œ ë¯¸ì‚¬ë§Œ ì²´í¬í•´ì£¼ì„¸ìš”."
    â”œâ”€â”€ CalendarSection
    â”‚   â””â”€â”€ MassEventCard (title + ë‚ ì§œ + ì²´í¬ë°•ìŠ¤)
    â”œâ”€â”€ CheckAllSection
    â”‚   â””â”€â”€ [ëª¨ë“  ì¼ì •ì— ì°¸ì„ ê°€ëŠ¥í•©ë‹ˆë‹¤] ì²´í¬ë°•ìŠ¤
    â”œâ”€â”€ SubmitButton ("ì œì¶œ")
    â””â”€â”€ Toast: ì„±ê³µ/ì—ëŸ¬ ì•Œë¦¼
```

## ðŸ§© 4. Firestore ë°ì´í„° ì—°ë™

### 4.1 ë¯¸ì‚¬ ì¼ì • ì¡°íšŒ

```lua
    collection(db, `server_groups/${serverGroupId}/mass_events`)
    where(date, >= startOfMonth)
    where(date, <= endOfMonth)
    orderBy(date)
```

## 4.2 ì„¤ë¬¸ ë©”íƒ€ í™•ì¸

```ts
    doc(db, `server_groups/${serverGroupId}/availability_surveys/${yyyymm}`)
```

statusê°€ "OPEN"ì´ ì•„ë‹ ê²½ìš° â€œì„¤ë¬¸ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.â€ ë©”ì‹œì§€ í‘œì‹œ í›„ ì‘ë‹µ ì°¨ë‹¨.

---

## ðŸ§© 5. ì œì¶œ ë°ì´í„° êµ¬ì¡°

```ts
// Doc ID: `${uid}_${yyyymm}`

{
  server_group_id: string,
  uid: string,
  yyyymm: string,
  unavailable: {
    [event_id: string]: false
  },
  dates?: string[],  // yyyymmdd ìœ ì§€ë³´ìˆ˜ìš©
  submitted_at: serverTimestamp(),
}
```

- ë¶ˆê°€ ì¼ì •ë§Œ ì €ìž¥ (false)
- ëª¨ë“  ì¼ì • ê°€ëŠ¥ ì‹œ: unavailable = {} ë˜ëŠ” null

---

## ðŸ§© 6. ìƒíƒœ ê´€ë¦¬

| ìƒíƒœëª…              | íƒ€ìž…                      | ì„¤ëª…               |
| ---------------- | ----------------------- | ---------------- |
| `events`         | `MassEventDoc[]`        | ì´ë²ˆ ë‹¬ ë¯¸ì‚¬ ì¼ì •       |
| `unavailableIds` | `string[]`              | ë³µì‚¬ê°€ ì„ íƒí•œ ë¶ˆê°€ ì¼ì • ID |
| `isAllAvailable` | `boolean`               | â€œëª¨ë“  ì¼ì • ê°€ëŠ¥â€ ì²´í¬ ìƒíƒœ |
| `isSubmitting`   | `boolean`               | ì œì¶œ ì¤‘ ì—¬ë¶€          |
| `submitted`      | `boolean`               | ì œì¶œ ì™„ë£Œ ì—¬ë¶€         |
| `surveyClosed`   | `boolean`               | ì„¤ë¬¸ì´ ë§ˆê°ëœ ìƒíƒœì¸ì§€ ì—¬ë¶€  |
| `user`           | `FirebaseUser` or `null` | ë¡œê·¸ì¸ ì‚¬ìš©ìž          |

---

## ðŸ§© 7. ì£¼ìš” ì´ë²¤íŠ¸ íë¦„

â‘  íŽ˜ì´ì§€ ë¡œë“œ

- URL paramì—ì„œ serverGroupId, yyyymm ì¶”ì¶œ
- í˜„ìž¬ ë¡œê·¸ì¸ ì‚¬ìš©ìž í™•ì¸ (useAuthState)
- ì„¤ë¬¸ ë¬¸ì„œ(availability_surveys/{yyyymm}) í™•ì¸
    â†’ ì—†ê±°ë‚˜ status !== "OPEN" â†’ ë§ˆê° ìƒíƒœ í‘œì‹œ
- mass_events ë¶ˆëŸ¬ì™€ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ

â‘¡ ë¶ˆê°€ ì¼ì • ì„ íƒ

- ì²´í¬ë°•ìŠ¤ í† ê¸€ ì‹œ unavailableIds ê°±ì‹ 
- â€œëª¨ë“  ì¼ì • ì°¸ì„â€ ì²´í¬ ì‹œ unavailableIds = []

â‘¢ ì œì¶œ ë²„íŠ¼ í´ë¦­

- ë¡œê·¸ì¸ ì•ˆë¨ â†’ â€œë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.â€
- ì„¤ë¬¸ ë§ˆê°ë¨ â†’ â€œì´ ì„¤ë¬¸ì€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.â€
- ìž…ë ¥ ì—†ìŒ â†’ â€œì°¸ì„ ë¶ˆê°€ ì¼ì • ë˜ëŠ” ì „ì²´ ì°¸ì„ì„ ì„ íƒí•˜ì„¸ìš”.â€
- í†µê³¼ ì‹œ Firestore setDoc() â†’ ì„±ê³µ ì‹œ Toast í‘œì‹œ + ë²„íŠ¼ ë¹„í™œì„±í™”
- ì„¤ë¬¸ ë§ˆê° ì „ì—ëŠ” ë³µì‚¬ê°€ ìžì‹ ì˜ ì‘ë‹µì„ ìˆ˜ì • í•´ì„œ ê³„ì† ì œì¶œ í•  ìˆ˜ ìžˆë‹¤.

### 7.1 ëª©í‘œ ë™ìž‘ ìš”ì•½

```lua
| ìƒíƒœ            | ì‚¬ìš©ìž ì•¡ì…˜      | ë™ìž‘ ê²°ê³¼                           |
| ------------- | ----------- | ------------------------------- |
| ðŸ”¹ ì„¤ë¬¸ì´ OPEN   | ì•„ì§ ì‘ë‹µ ì—†ìŒ    | ìƒˆ ë¬¸ì„œ(`setDoc`) ìƒì„±               |
| ðŸ”¹ ì„¤ë¬¸ì´ OPEN   | ì´ë¯¸ ì‘ë‹µ ìžˆìŒ    | ê¸°ì¡´ ë¬¸ì„œ **ë®ì–´ì“°ê¸°(update)** ê°€ëŠ¥       |
| ðŸ”¹ ì„¤ë¬¸ì´ CLOSED | ì‘ë‹µ íŽ˜ì´ì§€ ì ‘ê·¼ ì‹œ | â€œðŸ“‹ ì„¤ë¬¸ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.â€ ë©”ì‹œì§€ í‘œì‹œ, ìˆ˜ì • ë¶ˆê°€ |
```

---

## ðŸ§© 8. UI ì„¤ê³„

| ìš”ì†Œ           | êµ¬ì„±                          |
| ------------ | --------------------------- |
| Header       | "âœï¸ ë³µì‚¬ ì„¤ë¬¸ (10ì›”)" + ë¡œê·¸ì¸ ì´ë¦„   |
| InfoAlert    | íšŒìƒ‰ ìƒìž: â€œì°¸ì„ ë¶ˆê°€í•œ ì¼ì •ë§Œ ì²´í¬í•´ì£¼ì„¸ìš”.â€ |
| EventList    | ë¯¸ì‚¬ ì œëª© + ë‚ ì§œ + ì²´í¬ë°•ìŠ¤ (ë¶ˆê°€ ì„ íƒìš©)  |
| CheckAll     | "ëª¨ë“  ì¼ì • ì°¸ì„" ì²´í¬ë°•ìŠ¤             |
| SubmitButton | ì œì¶œ ìƒíƒœ/ë¹„í™œì„±í™” ì¡°ê±´ ë°˜ì˜            |
| Toast        | ê²°ê³¼ ì•Œë¦¼                       |

---

## ðŸ§© 9. ê²€ì¦ ë¡œì§

| ì¡°ê±´           | ë©”ì‹œì§€                                      |
| ------------ | ---------------------------------------- |
| ë¡œê·¸ì¸ ì•ˆë¨       | â€œë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.â€                            |
| ì„¤ë¬¸ ë§ˆê°ë¨       | â€œì´ ì„¤ë¬¸ì€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.â€                         |
| ì„ íƒ ì—†ìŒ        | â€œì°¸ì„ ë¶ˆê°€í•œ ì¼ì •ì„ ì„ íƒí•˜ê±°ë‚˜, ëª¨ë“  ì¼ì •ì— ì°¸ì„í•©ë‹ˆë‹¤ë¥¼ ì²´í¬í•˜ì„¸ìš”.â€ |
| Firestore ì‹¤íŒ¨ | â€œì €ìž¥ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.â€                       |
| ì„±ê³µ           | â€œâœ… ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.â€                         |

## ðŸ§© 10. UX / ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ

| ìƒí™©        | í™”ë©´ ë™ìž‘                     |
| --------- | ------------------------- |
| ì„¤ë¬¸ì´ ì—´ë ¤ ìžˆìŒ | ë‹¬ë ¥ ë¡œë“œ + ë¶ˆê°€ ì„ íƒ ê°€ëŠ¥          |
| ì„¤ë¬¸ì´ ë§ˆê°ë¨   | íšŒìƒ‰ ë°•ìŠ¤ + â€œë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.â€ ì•ˆë‚´     |
| ì œì¶œ í›„ ìž¬ë°©ë¬¸  | ê¸°ì¡´ ì‘ë‹µ í‘œì‹œ + ìˆ˜ì • ë¶ˆê°€          |
| ëª¨ë“  ì¼ì • ê°€ëŠ¥  | â€œëª¨ë“  ì¼ì • ì°¸ì„â€ ì²´í¬ ì‹œ ì œì¶œ ë²„íŠ¼ í™œì„±í™” |

---

## ðŸ§© 11. ì—°ê³„ ë¬¸ì„œ

| ë¬¸ì„œ                 | íŒŒì¼                                    |
| ------------------ | ------------------------------------- |
| 2.6.1 ì„¤ë¬¸ ê°œì‹œ Drawer | `PRD-2.6.1-SendSurveyDrawer.md`       |
| 3.4.2 Firestore ëª¨ë¸ | `PRD-3.4.2-Firestore doc Modeling.md` |
| 2.13 App UI/UX     | `PRD-2.13-App-UIUX.md`                |

---

## ðŸ§© 12. í™•ìž¥ ê¸°ëŠ¥

- ì œì¶œ í›„ â€œì‘ë‹µ í™•ì¸â€ ëª¨ë“œ (ë³¸ì¸ ì‘ë‹µ read-only í‘œì‹œ)
- ë§ˆê° í›„ â€œì„¤ë¬¸ ë§ˆê° ì•ˆë‚´ íŽ˜ì´ì§€â€ ìžë™ ì „í™˜

---
