# PRD 2.6 ë³µì‚¬ ê°€ìš©ì„± ì„¤ë¬¸ (Availability) (PRD-2.6-Availability Survey.md)

## ğŸ§© 1. ì„¹ì…˜ ê°œìš”

ë³¸ ì„¹ì…˜ì€ ë³µì‚¬(Server)ë“¤ì´ ì›” ë‹¨ìœ„ë¡œ ìì‹ ì˜ **ê°€ìš©ì„±(Availability)** ì„ ì…ë ¥í•˜ëŠ” ì„¤ë¬¸ ê¸°ëŠ¥ì„ ì •ì˜í•œë‹¤.
ì„¤ë¬¸ì€ ê° ë³µì‚¬ë‹¨(`server_groups/{id}`)ì˜ í™•ì •ëœ ë¯¸ì‚¬ ì¼ì •(`mass_events`)ì„ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
ë³µì‚¬ëŠ” ì°¸ì„ ë¶ˆê°€ ì¼ì •ë§Œ ì„ íƒí•˜ì—¬ ì œì¶œí•˜ë©°, ë¶ˆê°€ ì¼ì •ë§Œ Firestoreì— ì €ì¥ëœë‹¤.
ëª¨ë“  ì¼ì •ì´ ì°¸ì„ ê°€ëŠ¥í•œ ê²½ìš°ì—ëŠ” ë‹¬ë ¥ ìˆ˜ì • ì—†ì´ "ëª¨ë“  ì¼ì •ì— ì°¸ì„ ê°€ëŠ¥í•©ë‹ˆë‹¤" ì²´í¬ í›„ ì œì¶œí•œë‹¤.

### 1.1 ì„¤ë¬¸ ì—…ë¬´ ì ˆì°¨

â‘  MassEventPlanner í™”ë©´ì—ì„œ [ì„¤ë¬¸ ì§„í–‰] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ drawer ê°€ ìš°ì¸¡ì— ì—´ë ¤ì„œ ìƒì„¸ ì—…ë¬´ë¥¼ ì§„í–‰í•¨.
â‘¡ drawer ì—ì„œ ì„¤ë¬¸ëŒ€ìƒìë¥¼ í™•ì¸.(defaultë¡œ ì „ì²´ membersë¥¼ ë³´ì—¬ì£¼ê³  ì„ íƒí•˜ì—¬ ì œì™¸ í•  ìˆ˜ ìˆë„ë¡ í•¨)
â‘¢ ì„¤ë¬¸ì¼ì • ì„¤ì •: 'ì„¤ë¬¸ì‹œì‘ì¼(default ì˜¤ëŠ˜)'~'ì„¤ë¬¸ì¢…ë£Œì¼(default ì¼ì£¼ì¼ë’¤)' ì§€ì •, ë‹¬ë ¥ê¸°ëŠ¥ìœ¼ë¡œ ì„ íƒ.
â‘£ [ì„¤ë¬¸ ì‹œì‘] ë²„íŠ¼ì„ ëˆ„ë¦„.
â‘¤ validation check :
  . Status ìƒíƒœê°€ `MASS-CONFIRMED` ì¸ì§€ í™•ì¸í•¨. ì•„ë‹Œ ê²½ìš° alert+return.
  . í•„ìˆ˜ì…ë ¥í•­ëª© ì²´í¬.
â‘¥ validation checkë¥¼ í†µê³¼í•˜ë©´ ë³µì‚¬ì—ê²Œ ì•Œë ¤ì¤„ urlì„ í™”ë©´ì— í‘œì‹œí•˜ê³  ì˜†ì— [URL ë³µì‚¬] ë²„íŠ¼ì„ ë°°ì¹˜í•¨.
â‘¦ plannerëŠ” ì´ urlì„ ì¹´ì¹´ì˜¤í†¡ ë“±ì˜ ë³„ë„ì˜ ë„êµ¬ë¥¼ í†µí•´ ë³µì‚¬ë“¤ì—ê²Œ ê³µìœ .
â‘§ ë³µì‚¬ ê°œì¸ì€ í•´ë‹¹ urlì„ í´ë¦­í•˜ì—¬ Appì˜ ì„¤ë¬¸ í™”ë©´ ë‹¬ë ¥ì—ì„œ í™•ì •ëœ ë¯¸ì‚¬ì¼ì • ì¤‘ ë³¸ì¸ì´ 'ë¶ˆê°€'í•œ ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  ì œì¶œí•¨.
  ë¶ˆê°€í•˜ì§€ ì•ŠëŠ” ë¯¸ì‚¬ì¼ì •ì€ ëª¨ë‘ ê°€ëŠ¥í•œ ê²ƒìœ¼ë¡œ ë‚´ë¶€ì ìœ¼ë¡œ ì¸ì‹í•˜ë©´ ë¨.
  í™”ë©´ ë‹¬ë ¥ ë¯¸ì‚¬ì¼ì • ì¹´ë“œì˜ default ìƒíƒœëŠ” ëª¨ë‘ 'ì°¸ì„ê°€ëŠ¥' ìœ¼ë¡œ í‘œì‹œí•˜ê³  'ë¶ˆê°€' í•œ ë‚ ë§Œ í† ê¸€ë¡œ ì²´í¬í•˜ì—¬ 'ë¶ˆê°€'ë¡œ ë³€ê²½ì‹œí‚´.

---

## ğŸ§© 2. ì£¼ìš” ëª©í‘œ ë° ì„¤ê³„ ì›ì¹™

| í•­ëª©         | ì„¤ëª…                                              |
| ---------- | ----------------------------------------------- |
| ğŸ“… ì„¤ë¬¸ ëŒ€ìƒ   | `month_status = MASS-CONFIRMED` ìƒíƒœì¼ ë•Œë§Œ ì„¤ë¬¸ ì‹œì‘ ê°€ëŠ¥ |
| ğŸ‘¤ ëŒ€ìƒì ê´€ë¦¬  | Drawer ê¸°ë³¸ê°’ = ì „ì²´ members / í•„ìš” ì‹œ ì¼ë¶€ ì œì™¸ ê°€ëŠ¥         |
| ğŸ—“ï¸ ì‘ë‹µ ë°©ì‹  | ë¶ˆê°€ ì¼ì •ë§Œ ì €ì¥ (`false`), ë‚˜ë¨¸ì§€ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ê°€ëŠ¥(true) ì²˜ë¦¬     |
| ğŸ’¾ ë°ì´í„° íƒ€ì…  | `"UNAVAILABLE"` â†’ boolean(`false`)              |
| ğŸ§¢ ì¶”ê°€ í•„ë“œ   | event_idë³„ `event_date (yyyymmdd)` ì¶”ê°€            |
| ğŸ§ ì„¤ë¬¸ ë§ˆê°   | Plannerê°€ MassEventPlanner í™”ë©´ì—ì„œ ì§ì ‘ ìˆ˜í–‰            |
| âœ… ëª¨ë‘ ì°¸ì„ ì˜µì…˜ | â€œëª¨ë“  ì¼ì •ì— ì°¸ì„ ê°€ëŠ¥í•©ë‹ˆë‹¤â€ ì²´í¬ í›„ ì œì¶œ ê°€ëŠ¥                    |
| âš™ï¸ ë¹ˆ ì‘ë‹µ í—ˆìš© | ëª¨ë‘ ì°¸ì„ ì‹œ `responses` ë° `dates` = `null` ì €ì¥ í—ˆìš©    |

---

## ğŸ§© 3. í”Œë ˆë„ˆìš© Drawer (SendSurveyDrawer)

### êµ¬ì¡°

```lua
SendSurveyDrawer
 â”œâ”€â”€ Header: ğŸ“© ë³µì‚¬ ì¼ì • ì„¤ë¬¸
 â”œâ”€â”€ Body:
 â”‚   â”œâ”€â”€ ì„¤ë¬¸ ê¸°ê°„ ì„¤ì • (Start Date, End Date) - ê°€ë¡œ ë°°ì¹˜
 â”‚   â”œâ”€â”€ ì„¤ë¬¸ ëŒ€ìƒì ì •ë ¬ íƒ­ (ì´ë¦„ / í•™ë…„) - Segmented Control
 â”‚   â”œâ”€â”€ ì„¤ë¬¸ ëŒ€ìƒì ì„ íƒ (Checkbox list, max-height: 560px)
 â”‚       â””â”€â”€ í•™ë…„ ì •ë ¬ ì‹œ ê°€ë¡œ êµ¬ë¶„ì„  í‘œì‹œ
 â”‚   â”œâ”€â”€ (ì‹œì‘ ì„±ê³µ ì‹œ) ê³µìœ  URL + [URL ë³µì‚¬] ë²„íŠ¼
 â””â”€â”€ Footer:
     â”œâ”€â”€ [ë‹«ê¸°] ë²„íŠ¼ + [ì„¤ë¬¸ ì‹œì‘] ë²„íŠ¼ (ê°€ë¡œ ë°°ì¹˜)
```

### ë™ì‘ ì‹œí€€ìŠ¤

1. Plannerê°€ [ì„¤ë¬¸ ì§„í–‰] ë²„íŠ¼ í´ë¦­ â†’ Drawer ì˜¤í”ˆ
2. ë³µì‚¬ë‹¨ì˜ í™œì„± members ëª©ë¡ì„ ëª¨ë‘ ë¡œë“œ (ê¸°ë³¸ ì „ì²´ ì„ íƒ)
3. í•„ìš” ì‹œ ì¼ë¶€ ì œì™¸ ê°€ëŠ¥
4. ì„¤ë¬¸ê¸°ê°„ ì„ íƒ (ê¸°ë³¸: ì˜¤ëŠ˜ ~ 7ì¼ ë’¤)
5. [ì„¤ë¬¸ ì‹œì‘] í´ë¦­ ì‹œ Firestore ë¬¸ì„œ ìƒì„±:

```ts
await setDoc(doc(db, `server_groups/${sg}/availability_surveys/${yyyymm}`), {
  start_date: fromLocalDateToFirestore(startDate, tz),
  end_date: fromLocalDateToFirestore(endDate, tz),
  member_ids: selectedMembers,
  created_at: serverTimestamp(),
  status: "OPEN",
}, { merge: true });
```

6. ì„±ê³µ ì‹œ Drawer ë‚´ì— ê³µìœ  URL í‘œì‹œ

```lua
https://altar-scheduler.web.app/survey/:serverGroupId/:yyyymm
```

### 3.1 í”Œë˜ë„ˆ ëŒ€ë¦¬ ì…ë ¥/ìˆ˜ì • (Proxy Submission)

í”Œë˜ë„ˆë‚˜ ê´€ë¦¬ìê°€ ë³µì‚¬(Server)ë¥¼ ëŒ€ì‹ í•˜ì—¬ ì§ì ‘ ì„¤ë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•  ê²½ìš°ê°€ ìˆë‹¤. (ì˜ˆ: ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš©ì´ ì–´ë ¤ìš´ ê²½ìš°, êµ¬ë‘ë¡œ ì¼ì •ì„ í†µë³´ë°›ì€ ê²½ìš° ë“±)

#### UI/UX ë™ì‘
1. **ì§„ì…ì **: `SendSurveyDrawer` ì˜ í•˜ë‹¨ ë³µì‚¬ ëª…ë‹¨ ë¦¬ìŠ¤íŠ¸.
2. **ë™ì‘**:
   - ê° ë³µì‚¬ ì´ë¦„ ìš°ì¸¡ì˜ **[ìˆ˜ì •] (ì—°í•„ ì•„ì´ì½˜)** ë²„íŠ¼ í´ë¦­.
   - **ìƒˆ ì°½(ë˜ëŠ” ìƒˆ íƒ­)** ìœ¼ë¡œ í•´ë‹¹ ë³µì‚¬ì˜ ì„¤ë¬¸ í˜ì´ì§€(`/survey/:sgId/:month?uid=:targetUid`)ê°€ ì—´ë¦¼.
   - ìƒˆ ì°½ì˜ í—¤ë”ì—ëŠ” [ë’¤ë¡œê°€ê¸°] ëŒ€ì‹  **[ì°½ ë‹«ê¸°(X)]** ë²„íŠ¼ì´ í‘œì‹œë¨ (Planner Workflow ë³´í˜¸).
3. **ê¶Œí•œ**:
   - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ **Planner** ë˜ëŠ” **Admin** ê¶Œí•œì„ ê°€ì§„ ê²½ìš°ì—ë§Œ íƒ€ì¸(`targetUid`)ì˜ ì„¤ë¬¸ í˜ì´ì§€ì— ì ‘ê·¼ ë° ì œì¶œ ê°€ëŠ¥.
   - ê¶Œí•œì´ ì—†ëŠ” ê²½ìš°(ì¼ë°˜ Server) íƒ€ì¸ì˜ UIDë¡œ ì ‘ê·¼ ì‹œ "ëŒ€ìƒìê°€ ì•„ë‹™ë‹ˆë‹¤" ê²½ê³  í‘œì‹œ.

---
 
 ## ğŸ§© 3.5 ì„¤ë¬¸ ê´€ë¦¬ í˜ì´ì§€ (SurveyManagement)
 
 ### ê²½ë¡œ
 `/server-groups/{serverGroupId}/surveys`
 
 ### ì£¼ìš” ê¸°ëŠ¥
 
 1. **ì„¤ë¬¸ ëª©ë¡ ì¡°íšŒ**:
    - ìƒì„±ëœ ëª¨ë“  ê°€ìš©ì„± ì„¤ë¬¸(`availability_surveys`)ì„ ìµœì‹ ìˆœ(YYYYMM ë‚´ë¦¼ì°¨ìˆœ)ìœ¼ë¡œ í‘œì‹œ.
    - ê° ì¹´ë“œì— ì„¤ë¬¸ ê¸°ê°„, ìƒíƒœ(OPEN/CLOSED), ì‘ë‹µë¥ (%) í‘œì‹œ.
 
 2. **ìƒˆë¡œê³ ì¹¨**:
    - ìš°ì¸¡ ìƒë‹¨ [ìƒˆë¡œê³ ì¹¨] ë²„íŠ¼ ì œê³µ (ìˆ˜ë™ ë°ì´í„° ê°±ì‹ ).
 
 3. **ìƒì„¸ ì‘ë‹µ í˜„í™© (Drawer)**:
    - ì„¤ë¬¸ ì¹´ë“œ í´ë¦­ ì‹œ ìš°ì¸¡ Drawer ì˜¤í”ˆ.
    - **í†µê³„**: ì´ ëŒ€ìƒì ìˆ˜ í‘œì‹œ.
    - **ì‘ë‹µì ëª©ë¡**: 
      - ì œì¶œ ì™„ë£Œ(í‘¸ë¥¸ìƒ‰ ë°°ê²½) / ë¯¸ì œì¶œ(êµ¬ë¶„) ìƒíƒœ í‘œì‹œ.
      - ì´ë¦„, ì„¸ë¡€ëª…, í•™ë…„ ì •ë³´ í‘œì‹œ.
      - ì œì¶œ ì™„ë£Œìì˜ ê²½ìš° 'ë¶ˆì°¸' ì¼ì • ê°œìˆ˜ í‘œì‹œ ë“± ìš”ì•½ ì •ë³´ ì œê³µ.
 
 ---

## ğŸ§© 4. ë³µì‚¬ìš© ì„¤ë¬¸ í˜ì´ì§€ (`/survey/:serverGroupId/:yyyymm`)

### UI ë° ê¸°ëŠ¥

| í•­ëª©            | ì„¤ëª…                                      |
| ------------- | --------------------------------------- |
| ğŸ•³ ë‹¬ë ¥ í‘œì‹œ      | í•´ë‹¹ ì›”ì˜ ëª¨ë“  í™•ì • ë¯¸ì‚¬ ì¼ì •(`mass_events`) í‘œì‹œ     |
| ğŸ”— URL íŒŒë¼ë¯¸í„°   | `?uid=xxx`: í”Œë˜ë„ˆê°€ íŠ¹ì • ë³µì‚¬ë¥¼ ëŒ€ë¦¬í•˜ì—¬ ì ‘ì† ì‹œ ì‚¬ìš© |
| ğŸ”™ í—¤ë” ë„¤ë¹„ê²Œì´ì…˜ | ì¼ë°˜ ì§„ì… ì‹œ [ë’¤ë¡œê°€ê¸°(â†)], ìƒˆ ì°½(Popup) ì§„ì… ì‹œ [ë‹«ê¸°(X)] ë²„íŠ¼ í‘œì‹œ |
| âœ… ê¸°ë³¸ ìƒíƒœ       | ëª¨ë“  ì¼ì • = ì°¸ì„ ê°€ëŠ¥ (AVAILABLE)               |
| ğŸš« ë¶ˆê°€ í† ê·¸      | í´ë¦­/í„°ì¹˜ ì‹œ â€œë¶ˆê°€(false)â€ ë¡œ í† ê·¸                |
| ğŸ§¾ ëª¨ë‘ ì°¸ì„ ì²´í¬ë°•ìŠ¤ | ë‹¬ë ¥ì—ì„œ ì•„ë¬´ ë¶ˆê°€ ì„ íƒì´ ì—†ì„ ë•Œë§Œ í™œì„±í™”ë¨               |
| ğŸ’¾ ì œì¶œ ì¡°ê±´      | ë¶ˆê°€ ì¼ì • â‰¥ 1 ë˜ëŠ” ëª¨ë‘ ì°¸ì„ ì²´í¬ âœ…                 |
| ğŸ” ìˆ˜ì • ê°€ëŠ¥      | ì„¤ë¬¸ ë§ˆê° ì „(`SURVEY-CONFIRMED` ì´ì „)ê¹Œì§€ ì¬ì œì¶œ ê°€ëŠ¥ |

---

## ğŸ§© 5. Firestore ë°ì´í„° êµ¬ì¡°

### ğŸ“˜ ì„¤ë¬¸ ë©”íƒ€ì •ë³´

```lua
server_groups/{sg}/availability_surveys/{yyyymm}
  â”œâ”€â”€ start_date: Timestamp
  â”œâ”€â”€ end_date: Timestamp
  â”œâ”€â”€ member_ids: string[]
  â”œâ”€â”€ created_at: Timestamp
  â””â”€â”€ status: "OPEN" | "CLOSED"
```

### ğŸ“˜ ì„¤ë¬¸ ì‘ë‹µ

```lua
server_groups/{sg}/availability_surveys/{yyyymm}/responses/{member_id}
  â”œâ”€â”€ responses: Record<event_id, false> | null
  â”œâ”€â”€ dates: Record<event_id, string(yyyymmdd)> | null
  â”œâ”€â”€ created_at: Timestamp
  â””â”€â”€ updated_at: Timestamp
```

#### ì˜ˆì‹œ 1 â€” ì¼ë¶€ ë¶ˆê°€ ì„ íƒ

```json
{
  "responses": { "ME00005": false, "ME00007": false },
  "dates": { "ME00005": "20251005", "ME00007": "20251019" },
  "created_at": "2025-10-12T01:00:00Z",
  "updated_at": "2025-10-12T01:02:00Z"
}
```

#### ì˜ˆì‹œ 2 â€” ëª¨ë‘ ì°¸ì„

```json
{
  "responses": null,
  "dates": null,
  "created_at": "2025-10-12T01:00:00Z",
  "updated_at": "2025-10-12T01:01:00Z"
}
```

---

## ğŸ§© 6. ì œì¶œ ì¡°ê±´ ê²€ì¦

| ì¡°ê±´                      | ê²°ê³¼                                   |
| ----------------------- | ------------------------------------ |
| ë¶ˆê°€ ì¼ì • â‰¥ 1ê°œ              | âœ… ì œì¶œ ê°€ëŠ¥                              |
| ë¶ˆê°€ ì¼ì • 0ê°œ + â€œëª¨ë‘ ì°¸ì„â€ ì²´í¬ âœ… | âœ… ì œì¶œ ê°€ëŠ¥                              |
| ë¶ˆê°€ ì¼ì • 0ê°œ + â€œëª¨ë‘ ì°¸ì„â€ ë¯¸ì²´í¬  | âŒ ì œì¶œ ë¶ˆê°€ (â€œëª¨ë“  ì¼ì • ì°¸ì„ ì‹œ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ í˜¸í•´ì£¼ì„¸ìš”.â€) |

---

## ğŸ§© 7. ì„¤ë¬¸ ë§ˆê° (Planner ë™ì‘)

Plannerê°€ `MassEventPlanner` í™”ë©´ì˜ [ì„¤ë¬¸ ì¢…ë£Œ] ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë¨. ë³µì‚¬ëŠ” ì§ì ‘ ì„¤ë¬¸ì„ ë§ˆê°í•  ìˆ˜ ì—†ìŒ.

```ts
await setDoc(doc(db, `server_groups/${sg}/month_status/${yyyymm}`), {
  status: "SURVEY-CONFIRMED",
  updated_by: currentUser.email,
  updated_at: serverTimestamp(),
}, { merge: true });
```

Cloud Function(`onSurveyClosed`)ì´ í˜¸ì¶œë˜ì–´ ë¶ˆê°€ ì‘ë‹µìë¥¼ ì œì™¸í•œ `available_members` ê³„ì‚° í›„ ê° `mass_events` ë¬¸ì„œ ì—…ë°ì´íŠ¸.

---

## ğŸ§© 8. Cloud Function ì²˜ë¦¬ ê°œìš”

```ts
// onSurveyClosed (Cloud Function)
for each event_id in mass_events:
  unavailable_members = responses where responses[event_id] === false
  available_members = all_active_members - unavailable_members
  update mass_events[event_id].available_members = available_members
```

* `responses === null` â†’ ëª¨ë“  ì¼ì • ê°€ëŠ¥ìœ¼ë¡œ ê°„ì£¼
* `responses[eventId] === false` â†’ ë¶ˆê°€ë¡œ ì¸ì‹
* `dates` í•„ë“œëŠ” ìœ ì§€ë³´ìˆ˜ ë° ë¡œê·¸ìš©

---

## ğŸ§© 9. UI / UX ê°€ì´ë“œë¼ì¸

| ìš”ì†Œ     | ê·œì¹™                             |
| ------ | ------------------------------ |
| Drawer | ìš°ì¸¡ ìŠ¬ë¼ì´ë“œí˜• (`max-w-md`, fade-in) |
| ë²„íŠ¼     | `variant="outline" size="      |

---

## ğŸ§© 10. ê´€ë ¨ë¬¸ì„œ

| ê´€ë ¨ ì„¹ì…˜                        | íŒŒì¼                                         |
| ---------------------------- | ------------------------------------------ |
| 2.4.8 MassEvent Planner      | `PRD-2.4.8-MassEvent Planner UI.md`        |
| 2.5.5 Auto ServerAssignment  | `PRD-2.5.5-Auto ServerAssignment Logic.md` |
| 3.4.2 Firestore doc Modeling | `PRD-3.4.2-Firestore doc Modeling.md`      |
| 2.4.2.3 Timezone Handling    | `PRD-2.4.2.3-TimezoneHandling.md`          |
| 2.13 App UI & UX             | `PRD-2.13-App-UIUX.md`                     |

---

## ğŸ§© 11. Notifications (FCM)

ì„¤ë¬¸ ì§„í–‰ ë‹¨ê³„ì— ë”°ë¼ FCM(í‘¸ì‹œ ì•Œë¦¼)ì´ ë°œì†¡ëœë‹¤. ëª¨ë“  Cloud FunctionsëŠ” `asia-northeast3` (Seoul) ë¦¬ì „ì—ì„œ ì‹¤í–‰ëœë‹¤.

### 11.1 ê³µí†µ ìœ í‹¸ë¦¬í‹° (`fcmUtils.ts`)
ëª¨ë“  ì•Œë¦¼ ë°œì†¡ ë¡œì§ì€ `sendMulticastNotification` í•¨ìˆ˜ë¡œ ê³µí†µí™”í•˜ì—¬ ê´€ë¦¬í•œë‹¤.
*   **Input**: `parentUids` (ìˆ˜ì‹ ì UID ëª©ë¡), `payload` (ì œëª©, ë³¸ë¬¸, ë°ì´í„°, ë§í¬)
*   **Process**:
    1.  `users/{uid}` ë¬¸ì„œì—ì„œ `fcm_tokens` í•„ë“œë¥¼ ì¡°íšŒ.
    2.  ëª¨ë“  í† í°ì„ ìˆ˜ì§‘ í›„ ì¤‘ë³µ ì œê±° (`Set` ì‚¬ìš©).
    3.  `admin.messaging().sendEachForMulticast`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ê´„ ë°œì†¡.
    4.  WebPush ê·œê²©(`webpush.fcmOptions.link`)ì„ í¬í•¨í•˜ì—¬ ì•Œë¦¼ í´ë¦­ ì‹œ ë”¥ë§í¬ ì´ë™ ì§€ì›.
*   **Benefit**: ê°œë³„ í•¨ìˆ˜ì—ì„œ í† í° ì¡°íšŒ ë¡œì§ì„ ì¤‘ë³µ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ìŒ.

### 11.2 ì„¤ë¬¸ ì‹œì‘ ì•Œë¦¼ (`onSurveyOpened`)
*   **Trigger**: `server_groups/{sgId}/availability_surveys/{month}` ë¬¸ì„œ ìƒì„±/ìˆ˜ì • (Write)
*   **Target**: í•´ë‹¹ ê·¸ë£¹ì˜ ëª¨ë“  ë©¤ë²„(ë¶€ëª¨ ê³„ì •)
*   **Message**:
    *   Title: "ğŸ“‹ ë¯¸ì‚¬ ë°°ì • ì„¤ë¬¸ ì‹œì‘"
    *   Body: "{N}ì›” ë¯¸ì‚¬ ë°°ì • ì„¤ë¬¸ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì•±ì—ì„œ ì°¸ì—¬í•´ì£¼ì„¸ìš”!"
    *   Action: ì„¤ë¬¸ í˜ì´ì§€ë¡œ ì´ë™ (`/survey/{sgId}/{month}`)

### 11.3 ì„¤ë¬¸ ë§ˆê° ë° í™•ì • ì•Œë¦¼ (`onSurveyClosed`)
*   **Trigger**: `availability_surveys/{month}` ë¬¸ì„œì˜ `status` ë³€ê²½ (Update)
*   **Logic**:
    *   Statusê°€ `CLOSED`ë¡œ ë³€ê²½ ì‹œ: "ğŸ”’ ë¯¸ì‚¬ ë°°ì • ì„¤ë¬¸ ë§ˆê°" ì•Œë¦¼
    *   Statusê°€ `CONFIRMED`ë¡œ ë³€ê²½ ì‹œ: "âœ… ë¯¸ì‚¬ ë°°ì • í™•ì •" ì•Œë¦¼
*   **Message (Confirmed)**:
    *   Title: "âœ… ë¯¸ì‚¬ ë°°ì • í™•ì •"
    *   Body: "{N}ì›” ë³µì‚¬ ë°°ì •í‘œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ì£¼ì„¸ìš”!"
    *   Action: ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™ (`/server-groups/{sgId}`)
